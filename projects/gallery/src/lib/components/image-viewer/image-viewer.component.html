<ng-container *ngIf="showPrevArrow">
  <ng-container *ngIf="!prevArrowTemplate; else prevArrowTemplate">
    <ngx-chevron-icon class="prev" (click)="prev()"></ngx-chevron-icon>
  </ng-container>
</ng-container>

<ul
  #itemList
  [class.hidden]="imagesHidden"
  [style.transitionDuration]="noAnimation ? '0ms' : ''"
>
  <li *ngIf="!items?.length" class="initial-item"></li>
  <li
    #items
    *ngFor="let item of items; let i = index"
    [class.selected]="i === selectedIndex"
    ondragstart="return false"
    (click)="onImageClick(item, $event)"
  >
    <ng-container *ngIf="!itemTemplate; else customTemplate">
      <img
        *ngIf="!isYoutube(item) && !item.video"
        [src]="getSrc(item)"
        [alt]="item.alt"
        [class.loading]="item._visited && !item._loaded"
        [style.objectFit]="objectFit"
        (load)="onItemLoaded(item, $event)"
        (error)="onItemErrored(item, $event)"
      />
      <!-- Using loadedmetadata instead of loadeddata because iOS loads data lazily upon user's interaction -->
      <video
        *ngIf="!isYoutube(item) && item.video"
        [src]="getSrc(item)"
        [class.loading]="item._visited && !item._loaded"
        [style.objectFit]="objectFit"
        controls
        playsinline
        (loadedmetadata)="onItemLoaded(item, $event)"
        (error)="onItemErrored(item, $event)"
      ></video>
      <iframe
        *ngIf="isYoutube(item)"
        [src]="getSrc(item) | safe"
        frameborder="0"
        allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
        (load)="onItemLoaded(item, $event)"
      ></iframe>

      <ng-container *ngIf="item._visited && !item._loaded">
        <ng-container *ngTemplateOutlet="loadingTemplate"></ng-container>
      </ng-container>

      <div *ngIf="item._failed" class="error">
        <div class="icon">!</div>
        <p class="text">{{ errorText || 'Loading of this media failed' }}</p>
      </div>
    </ng-container>

    <ng-template #customTemplate>
      <ng-container
        *ngTemplateOutlet="
          itemTemplate;
          context: {
            index: i,
            selectedIndex: selectedIndex,
            item: item,
            visited: item._visited
          }
        "
      ></ng-container>
    </ng-template>
  </li>
</ul>

<ng-container *ngIf="showNextArrow">
  <ng-container *ngIf="!nextArrowTemplate; else nextArrowTemplate">
    <ngx-chevron-icon class="next" (click)="next()"></ngx-chevron-icon>
  </ng-container>
</ng-container>

<ngx-image-counter
  *ngIf="imageCounter && items?.length"
  [itemQuantity]="items?.length"
  [selectedIndex]="selectedIndex"
  [orientation]="imageCounterOrientation"
></ngx-image-counter>

<div
  *ngIf="descriptions"
  class="description-container"
  [class.above-counter]="imageCounterOrientation === 'bottom'"
>
  <div
    *ngIf="items[selectedIndex].description as description"
    class="description"
    [innerHTML]="description"
    (click)="descriptionClick.emit($event)"
  ></div>
</div>
